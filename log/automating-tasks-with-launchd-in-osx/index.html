<!DOCTYPE html>
<html lang="en" class="no-js"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Automating Tasks With launchd In OS X | sean henderson</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Automating Tasks With launchd In OS X" />
<meta name="author" content="Sean Henderson" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Just got into some lanchd automation with OS X. I wanted an automatic rsync of my 1Password Anywhere files to a remote web server, as a DIY public web service for 1Password." />
<meta property="og:description" content="Just got into some lanchd automation with OS X. I wanted an automatic rsync of my 1Password Anywhere files to a remote web server, as a DIY public web service for 1Password." />
<meta property="og:site_name" content="sean henderson" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-07-03T08:38:00-07:00" />
<script type="application/ld+json">
{"url":"/log/automating-tasks-with-launchd-in-osx/","author":{"@type":"Person","name":"Sean Henderson"},"description":"Just got into some lanchd automation with OS X. I wanted an automatic rsync of my 1Password Anywhere files to a remote web server, as a DIY public web service for 1Password.","headline":"Automating Tasks With launchd In OS X","dateModified":"2014-07-03T08:38:00-07:00","datePublished":"2014-07-03T08:38:00-07:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/log/automating-tasks-with-launchd-in-osx/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<script>
    // this is reversed in app.js. transition in inline styles
    document.querySelector('html').style.opacity = 0;
  </script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link class="theme-variant" rel="stylesheet" title="Materialized Dark" href="/assets/themes/materialized-dark.css" type="text/css">
  <link class="theme-variant" rel="alternate stylesheet" title="Materialized Light" href="/assets/themes/materialized-light.css" type="text/css">
  <link class="theme-variant" rel="alternate stylesheet" title="High Contrast" href="/assets/themes/high-contrast.css" type="text/css">
  <script src="/assets/js/modernizr.min.js"></script><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="sean henderson" /><style>
/* fade in on loaded */
html.loaded {
  transition: opacity .5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

html.loaded {
  opacity: 1;
}

/* loading animation */
.loaded .loading-ring.page {
  display: none;
}

.loading-ring.page {
  display: block;
  width: 100px;
  height: 100px;
  position: relative;
}

.loading-ring.page {
  bottom: 0;
  left: 0;
  margin: auto;
  position: fixed;
  right: 0;
  top: 0;
}
.loading-ring.blog {
  margin: 0 auto;
  width: 54px;
}

.loading-ring div {
  box-sizing: border-box;
  display: block;
  position: absolute;
  width: 51px;
  height: 51px;
  margin: 6px;
  border: 6px solid #fff;
  border-radius: 50%;
  animation: loading-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
  border-color: #d33682 transparent transparent transparent;
}
.loading-ring div:nth-child(1) {
  animation-delay: -0.45s;
}
.loading-ring div:nth-child(2) {
  animation-delay: -0.3s;
}
.loading-ring div:nth-child(3) {
  animation-delay: -0.15s;
}

@keyframes loading-ring {
  0% {
    transform: rotate(0deg);
  }
  50% {
  }
  100% {
    transform: rotate(360deg);
  }
}

</style>
</head>
<body><header class="page-header" role="banner"><!-- Dropdown Structure -->
  <ul id="dropdown-more" class="dropdown-content">
    <li><a class="theme-timed" href="#!"><i class="fas fa-moon"></i><span>Night</span> Mode</a></li>
    <li><a class="theme-auto" data-theme="Auto" href="#!"><i class="fas fa-clock"></i>Automatic</a></li>
    <li><a class="theme-select" data-theme="High Contrast" href="#!"><i class="fas fa-adjust"></i>High Contast</a></li>
    <!--<li><a href="#!">three</a></li>-->
    <!--li class="divider" tabindex="-1"></li>-->
  </ul>
  <div class="navbar-fixed">
    <nav class="nav-main">
      <div class="nav-wrapper container">
        <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="fas fa-bars"><span class="sr-only">menu</span></i></a>
        <div class="brand-logo center">
          <a href="/">./sean</a><span class="hide-on-small-only"><a href="/log">/log</a><a href="#">/post</a></span>
        </div>
        <ul class="left hide-on-large-and-down" id="nav-large"><li><a class="page-link" href="/"><i class="fas fa-user"></i>About
  </a></li><li><a class="page-link" href="/log/"><i class="fas fa-pencil-alt"></i>log
  </a></li></ul>
        <ul class="right">
          <li>
            <a class="dropdown-trigger" href="#!" data-target="dropdown-more">
              <i class="fas fa-ellipsis-v right"><span class="sr-only">more</span></i>
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
  <ul class="sidenav" id="nav-mobile"><li><a class="page-link" href="/"><i class="fas fa-user"></i>About
  </a></li><li><a class="page-link" href="/log/"><i class="fas fa-pencil-alt"></i>log
  </a></li></ul></header>
<main class="page-content" aria-label="Content">
      <article class="post h-entry container anchorize" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="post-main">
    <header class="post-header">
      <h1 class="post-title p-name" itemprop="name headline">Automating Tasks With launchd In OS X</h1>
      <p class="post-meta">
        {
        <br>
        <span class="indent">
          date: <time class="dt-published" datetime="2014-07-03T08:38:00-07:00" itemprop="datePublished">2014-07-03 08:38:00 -0700</time>,<br>
            author: "<span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Sean Henderson</span></span>",<br>
          <span class="tags">
            tags: [
            
              <a href="/log/tag/hacks/">hacks</a>,
            
              <a href="/log/tag/security/">security</a>,
            
              <a href="/log/tag/shell/">shell</a>,
            
              <a href="/log/tag/macOS/">macOS</a>,
            
            ]
          </span>
        </span>
        }
      </p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
      <div class="toc-container"></div>
      <div class="post-content-inner">
        <p>Just got into some <code class="highlighter-rouge">lanchd</code> automation with OS X. I wanted an automatic <code class="highlighter-rouge">rsync</code> of my <a href="http://help.agilebits.com/1Password3/1passwordanywhere.html">1Password Anywhere</a> files to a remote web server, as a DIY public web service for 1Password.</p>

<p>First step: make a shell script with whatever you want to do, and save it in your <code class="highlighter-rouge">$PATH</code>. For my 1Password sync, a simple <code class="highlighter-rouge">rsync</code> one-liner:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
rsync <span class="nt">-az</span> <span class="nt">--force</span> <span class="nt">--delete</span> <span class="nt">-e</span> <span class="s2">"ssh -p7890"</span> /Users/me/Dropbox/Apps/1Password.agilekeychain/. root@yourmama.com:/var/www/vhosts/etc/et.all/public_html/
</code></pre></div></div>

<p>Then: make a .plist file in XML format so <code class="highlighter-rouge">launchd</code> can understand what must be done. Set the <code class="highlighter-rouge">StartInterval</code> in seconds (300 means every 5 minutes).</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>com.YOURUSERNAME.NAMEOFTASK.backup<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
        <span class="nt">&lt;string&gt;</span>YOURSCRIPT.sh<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>StartInterval<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>300<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div></div>

<p>Save it as <code class="highlighter-rouge">com.YOURUSERNAME.NAMEOFTASK.backup.plist</code> in <code class="highlighter-rouge">~/Library/LaunchAgents/</code>. Be sure the file name matches the <code class="highlighter-rouge">&lt;string&gt;</code> for <code class="highlighter-rouge">&lt;key&gt;label&lt;/key&gt;</code> in the XML. Also make sure the ownership and permissions are proper.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown </span>root com.YOURUSERNAME.NAMEOFTASK.backup.plist
<span class="nb">sudo chmod </span>644 com.YOURUSERNAME.NAMEOFTASK.backup.plist
</code></pre></div></div>

<p>Now to tell OSX about our screenplay. Fire up a terminal and</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>launchctl <span class="nt">-w</span> load ~/Library/LaunchAgents/com.YOURUSERNAME.NAMEOFTASK.backup.plist
</code></pre></div></div>

<p>The <code class="highlighter-rouge">-w</code> flag tells <code class="highlighter-rouge">launchctl</code> to load without waiting for a system reboot.</p>

<p>BAM. Now your shell script will run in the background every 300 seconds.</p>

<p>For the 1Password setup, they use a file called <code class="highlighter-rouge">1Password.html</code>, meaning you have to add that to the URL. To streamline the process, I touched an <code class="highlighter-rouge">index.html</code> file on the server that redirects to the 1Password html.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"refresh"</span> <span class="na">content=</span><span class="s">"0; url=/1Password.html"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>So yes - my super top secret passwords are technically public on the Internet; however, they’re well encrypted and I’m usually a pretty nice dude… so nobody would hack me right? For the paranoid, you could add some redundancy with an apache <code class="highlighter-rouge">.htpasswd</code> file on the server. 2Passwords is better than one.</p>

      </div>
    </div>

    <a class="u-url" href="/log/automating-tasks-with-launchd-in-osx/" hidden></a>
  </div>
</article>
<aside class="more-posts cta-full-width">
  
    <a class="prev" href="/log/http-gzip-compression-on-a-mediatemple-(dv)/">
      <i class="fas fa-fast-backward"><span class="sr-only">Previous Post</span></i> 
      <span>
        HTTP gzip compression on a MediaT...
      </span>
    </a>
  
  
    <a class="next" href="/log/the-free-mega-weight-dropbox-alternative/">
      <span>
        The Free Mega-Weight Dropbox Alte... 
      </span>
      <i class="fas fa-fast-forward"><span class="sr-only">Next Post</span></i>
    </a>
  
</aside>
<aside class="comments"></aside>

    </main><footer class="page-footer">
  <data class="u-url" href="/"></data>

  <div class="container">
    <div class="row">
      <div class="col m6 s12">
        <div class="avatar" data-cycle="sean">
  <p>
    <a href="/assets/images/sean.jpg" title="view image">
      <img data-src="/assets/images/sean.jpg" alt="photo of Sean Henderson">
    </a>
    Sean Henderson<br>
  </p>
</div>
      </div>
      <div class="col m5 offset-m1 s12"><ul class="social-media-list"><li>
      <a href="mailto:mail@sean.sh">
        <i class="fas fa-envelope fa-fw"><span class="sr-only">Email</span></i>
        <span class="u-email">mail@sean.sh</span>
      </a>
    </li><li><a href="https://github.com/sh78">
        <i class="fab fa-github fa-fw"><span class="sr-only">GitHub</span></i>
        <span class="username">sh78</span>
      </a><a href="https://gitlab.com/sh78">
        <i class="fab fa-gitlab fa-fw"><span class="sr-only">GitLab</span></i>
        <span class="username">sh78</span>
      </a></li><li>
      <a href="https://stackoverflow.com/users%2F2537500%2Fsh78">
        <i class="fab fa-stack-overflow fa-fw"><span class="sr-only">StackOverflow</span></i>
        
        <span class="username">sh78</span>
      </a>
    </li><li>
      <a href="https://twitter.com/seanmh78">
        <i class="fab fa-twitter fa-fw"><span class="sr-only">Twitter</span></i>
        <span class="username">seanmh78</span>
      </a>
    </li><li>
      <a href="https://www.linkedin.com/in/seanmhenderson">
        <i class="fab fa-linkedin fa-fw"><span class="sr-only">linkedin</span></i>
        <span class="username">seanmhenderson</span>
      </a>
    </li><li>
      <a href="https://www.facebook.com/seanmhenderson">
        <i class="fab fa-facebook fa-fw"><span class="sr-only">facebook</span></i>
        <span class="username">seanmhenderson</span>
      </a>
    </li><li>
      <a href="https://www.youtube.com/SeanHenderson7">
        <i class="fab fa-youtube fa-fw"><span class="sr-only">youtube</span></i>
        <span class="username">SeanHenderson7</span>
      </a>
    </li><li>
      <a href="/feed.xml">
        <i class="fas fa-rss fa-fw"><span class="sr-only">rss</span></i>
        <span>rss</span>
      </a>
    </li></ul>
</div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      <p class="left">&copy; <code>nil</code></p>
      <p class="right">Made In California with <i class="fab fa-linux"><span class="sr-only">Linux</span></i> &amp; <i class="fas fa-beer"><span class="sr-only">beer</span></i></p>
    </div>
  </div>

</footer>
<div class="loading-ring page">
  <div></div>
  <div></div>
  <div></div>
  <div></div>
</div>
<script src="/assets/js/libs.js"></script>
    <script src="/assets/js/app.es5.js"></script>

  </body>

</html>
